<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Eventos Seguros</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Estilos para listas desplegables */
        .dropdown-menu-small {
            max-width: 150px;
            font-size: 13px;
            background-color: white; /* Fondo blanco por defecto */
            border-radius: 5px;
        }
        .dropdown-menu-small li {
            padding: 5px;
            cursor: pointer;
            color: black;
        }
        .dropdown-menu-small li:hover {
            background-color: #0d6efd; /* Azul igual que el botón "Nuevo Evento" */
            color: white;
        }
    </style>
</head>
<body>
<header>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">AppEventos</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <!-- Usuarios (Desplegable) -->
                    <li sec:authorize="hasRole('ROLE_ADMON')" class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            Usuarios
                        </a>
                        <ul class="dropdown-menu dropdown-menu-small">
                            <li th:each="usuario : ${usuarios}" th:text="${usuario.username}"></li>
                        </ul>
                    </li>

                    <!-- Perfiles (No desplegable) -->
                    <li sec:authorize="hasRole('ROLE_ADMON')" class="nav-item">
                        <a class="nav-link" href="#">Perfiles</a>
                    </li>

                    <!-- Tipos de Evento (Desplegable) -->
                    <li sec:authorize="hasRole('ROLE_ADMON')" class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            Tipos de Evento
                        </a>
                        <ul class="dropdown-menu dropdown-menu-small">
                            <li th:each="tipo : ${tipos}" th:text="${tipo.nombre}"></li>
                        </ul>
                    </li>

                    <!-- Eventos (Desplegable con Estado) -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            Eventos
                        </a>
                        <ul class="dropdown-menu dropdown-menu-small">
                            <li th:each="evento : ${eventos}" th:text="${evento.estado}"></li>
                        </ul>
                    </li>
                </ul>
            </div>
            <span sec:authentication="name"></span>
            <span th:text="${session.usuario == null ? 'Guest' : session.usuario.nombre}"></span>

            <ul class="nav justify-content-end">
                <li sec:authorize="!isAuthenticated()" class="nav-item"><a class="nav-link" th:href="@{/login}">Iniciar Sesión</a></li>
                <li sec:authorize="!isAuthenticated()" class="nav-item"><a class="nav-link" th:href="@{/registro}">Registrarse</a></li>
                <li sec:authorize="isAuthenticated()" class="nav-item"><a class="nav-link" th:href="@{/logout}">Cerrar Sesión</a></li>  
            </ul>
        </div>
    </nav>
</header>

<div class="container">
    <h1 class="text-primary">Lista de Eventos</h1>
    <p th:if="${mensaje != null}" th:text="${mensaje}" class="p-2 bg-danger bg-opacity-10 border border-danger border-start rounded text-danger d-inline-block"> </p>
    <div sec:authorize="hasAnyRole('ROLE_ADMON')">
        <a th:href="@{/eventos/alta}" class="btn btn-primary btn-sm">Nuevo Evento</a>
    </div>
    <table class="table table-striped table-sm">
        <tr>
            <th>Nombre</th>
            <th>Estado</th>
            <th>Aforo</th>
            <th>Fecha</th>
            <th>Precio/pna</th>
            <th>Opciones</th>
        </tr>
        <tr th:each="ele : ${eventos}">
            <td th:text="${ele.nombre}"></td>
            <td th:text="${ele.estado}"></td>
            <td th:text="${ele.aforoMaximo}"></td>
            <td th:text="${ele.fechaInicio}"></td>
            <td th:text="${ele.precio}"></td>
            <td>
                <a th:href="@{/public/verUno/{id}(id=${ele.idEvento})}" class="btn btn-success btn-sm">Ver detalle</a>
                <a sec:authorize="hasAnyRole('ROLE_ADMON')" th:href="@{/eventos/editar/{id}(id=${ele.idEvento})}" class="btn btn-success btn-sm">Modificar</a>
                <a sec:authorize="hasAnyRole('ROLE_ADMON')" th:href="@{/eventos/cancelar/{id}(id=${ele.idEvento})}" class="btn btn-danger btn-sm">Cancelar</a>
            </td>
        </tr>
    </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
